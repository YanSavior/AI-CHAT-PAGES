{"ast":null,"code":"import _objectWithoutProperties from\"D:/Projectsss/ai-chat-app1.0 - test - \\u526F\\u672C - \\u526F\\u672C/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _objectSpread from\"D:/Projectsss/ai-chat-app1.0 - test - \\u526F\\u672C - \\u526F\\u672C/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";const _excluded=[\"node\"];import React,{useState,useRef,useEffect}from'react';import axios from'axios';import ReactMarkdown from'react-markdown';import rehypeRaw from'rehype-raw';import EmojiPicker from'emoji-picker-react';import{graduateData}from'../data/graduateData';import pyfaData from'../data/pyfaData.json';import pyfaData1 from'../data/pyfaData-1.json';import AIAvatar from'./AIAvatar';// 创建一个配置了基础 URL 的 axios 实例\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const getApiBaseURL=()=>{// 如果是开发环境，使用本地地址\nif(process.env.NODE_ENV==='development'){return'http://localhost:8000';}// 如果是生产环境，使用部署的RAG API地址\n// TODO: 部署完成后，请将下面的URL替换为实际的Railway域名\n// 例如：https://your-app-name.railway.app\nreturn'https://your-rag-api.railway.app';// 替换为实际部署地址\n};const api=axios.create({baseURL:'https://api.deepseek.com',headers:{'Content-Type':'application/json','Authorization':'Bearer sk-7f5214ed15764dfea0b45c84c6d0c961'}});// RAG API客户端\nconst ragApi=axios.create({baseURL:getApiBaseURL(),headers:{'Content-Type':'application/json'}});// 辅助函数：根据用户输入内容智能匹配专业\nfunction extractMajorFromText(text){const majors=[{name:'微电子科学与工程',keywords:['微电子','集成电路']},{name:'机械设计制造及其自动化',keywords:['机械','自动化','机电']}// 可继续扩展\n];for(const major of majors){for(const kw of major.keywords){if(text.includes(kw))return major.name;}}return null;}const getPyfaTextByMajor=major=>{if(major==='微电子科学与工程')return pyfaData.join('\\n');if(major==='机械设计制造及其自动化')return pyfaData1.join('\\n');return'';};const SYSTEM_PROMPT=\"\\u4F60\\u662F\\u4E00\\u4F4D\\u6E29\\u6696\\u8D34\\u5FC3\\u7684\\u804C\\u4E1A\\u89C4\\u5212\\u987E\\u95EE\\u3002\\u65E0\\u8BBA\\u662F\\u9996\\u6B21\\u5EFA\\u8BAE\\u8FD8\\u662F\\u540E\\u7EED\\u6240\\u6709\\u56DE\\u7B54\\uFF0C\\u4F60\\u90FD\\u5FC5\\u987B\\u4E25\\u683C\\u53C2\\u8003\\u6211\\u63D0\\u4F9B\\u7684\\\"\\u57F9\\u517B\\u65B9\\u6848\\\"\\u5185\\u5BB9\\uFF0C\\u4E0D\\u80FD\\u8131\\u79BB\\u57F9\\u517B\\u65B9\\u6848\\u968F\\u610F\\u751F\\u6210\\u5EFA\\u8BAE\\u3002\\u6BCF\\u4E00\\u6761\\u5EFA\\u8BAE\\u90FD\\u8981\\u80FD\\u5728\\u57F9\\u517B\\u65B9\\u6848\\u4E2D\\u627E\\u5230\\u4F9D\\u636E\\u3002\\n\\n\\u6839\\u636E\\u7528\\u6237\\u662F\\u5426\\u662F\\u9996\\u6B21\\u5BF9\\u8BDD\\uFF0C\\u4F60\\u9700\\u8981\\u91C7\\u7528\\u4E0D\\u540C\\u7684\\u56DE\\u590D\\u65B9\\u5F0F\\uFF1A\\n\\n1. \\u5982\\u679C\\u8FD9\\u662F\\u7528\\u6237\\u7684\\u7B2C\\u4E00\\u6761\\u5B8C\\u6574\\u4FE1\\u606F\\uFF08\\u5305\\u542B\\u5B66\\u9662\\u91CC\\u7684\\u54EA\\u4E2A\\u4E13\\u4E1A\\u3001\\u5B66\\u4E60\\u9636\\u6BB5\\u3001\\u6210\\u7EE9\\u3001\\u5174\\u8DA3\\u7B49\\uFF09\\uFF0C\\u8BF7\\u6309\\u4EE5\\u4E0B\\u65B9\\u5F0F\\u56DE\\u590D\\uFF1A\\n   a) \\u9996\\u5148\\u8868\\u8FBE\\u7406\\u89E3\\u548C\\u8BA4\\u540C\\uFF0C\\u80AF\\u5B9A\\u7528\\u6237\\u5DF2\\u7ECF\\u505A\\u51FA\\u7684\\u52AA\\u529B\\n   b) \\u4ECE\\u6BD5\\u4E1A\\u751F\\u6570\\u636E\\u4E2D\\u9009\\u62E92-3\\u4F4D\\u6700\\u5339\\u914D\\u7684\\u5B66\\u957F\\u5B66\\u59D0\\uFF0C\\u7528\\u81EA\\u7136\\u7684\\u8BED\\u8A00\\u63CF\\u8FF0\\u4ED6\\u4EEC\\u7684\\u7ECF\\u5386\\uFF1A\\n      - \\u5F00\\u5934\\u8BF4\\u660E\\u5339\\u914D\\u5EA6\\uFF1A\\\"\\u4F60\\u4E0E[\\u59D3\\u540D]\\u5B66\\u957F/\\u5B66\\u59D0\\u5339\\u914D\\u5EA6\\u8F83\\u9AD8\\u3002\\\"\\n      - \\u7528\\u4E00\\u6BB5\\u8BDD\\u63CF\\u8FF0\\u8BE5\\u5B66\\u957F/\\u5B66\\u59D0\\u7684\\u60C5\\u51B5\\uFF08\\u7EE9\\u70B9\\u3001\\u6BD5\\u4E1A\\u53BB\\u5411\\u3001\\u85AA\\u8D44\\u3001\\u5728\\u6821\\u7ECF\\u5386\\uFF09\\n      - \\u7279\\u522B\\u8BF4\\u660E\\u4E3A\\u4EC0\\u4E48\\u4E0E\\u7528\\u6237\\u5339\\u914D\\uFF08\\u627E\\u5230\\u5171\\u540C\\u70B9\\u6216\\u4E92\\u8865\\u70B9\\uFF09\\n   c) \\u6700\\u540E\\u7ED9\\u51FA\\u8BE6\\u7EC6\\u7684\\u5EFA\\u8BAE\\uFF0C\\u8981\\u5305\\u542B\\u5177\\u4F53\\u7684\\u65F6\\u95F4\\u8282\\u70B9\\u548C\\u884C\\u52A8\\u6B65\\u9AA4\\uFF0C\\u4E00\\u5B9A\\u6CE8\\u610F\\u5EFA\\u8BAE\\u9700\\u8981\\u6839\\u636E\\u6211\\u63D0\\u4F9B\\u7ED9\\u4F60\\u7684\\u57F9\\u517B\\u65B9\\u6848\\uFF01\\u5E76\\u5728\\u56DE\\u590D\\u672B\\u5C3E\\u751F\\u6210\\u4E00\\u6BB5\\u6A2A\\u5411\\u7684\\u6280\\u80FD\\u6811\\uFF0C\\u8981\\u6C42\\u6280\\u80FD\\u6811\\u56FE\\u793A\\u5BCC\\u6709\\u751F\\u6C14\\uFF0C\\u4E14\\u4E0A\\u9762\\u4E0D\\u540C\\u4F4D\\u7F6E\\u6709\\u7740\\u4E0D\\u540C\\u7684\\u65F6\\u95F4\\uFF0C\\u6839\\u636E\\u57F9\\u517B\\u65B9\\u6848\\u6709\\u7740\\u4E0D\\u540C\\u7684\\u6280\\u80FD\\u6216\\u8BFE\\u7A0B\\uFF0C\\u53EF\\u4EE5\\u5C3D\\u91CF\\u8BE6\\u5C3D\\u4E00\\u70B9\\n\\n\\n2. \\u5982\\u679C\\u662F\\u7528\\u6237\\u540E\\u7EED\\u7684\\u95EE\\u9898\\u6216\\u56F0\\u60D1\\uFF1A\\n   a) \\u9996\\u5148\\u8868\\u8FBE\\u7406\\u89E3\\u548C\\u5171\\u60C5\\uFF0C\\u5B89\\u629A\\u7528\\u6237\\u7684\\u7126\\u8651\\n   b) \\u4ECE\\u5DF2\\u5206\\u4EAB\\u7684\\u5B66\\u957F\\u5B66\\u59D0\\u7ECF\\u5386\\u4E2D\\u63D0\\u53D6\\u76F8\\u5173\\u7684\\u7ECF\\u9A8C\\u548C\\u5EFA\\u8BAE\\n   c) \\u7528\\u6E29\\u6696\\u9F13\\u52B1\\u7684\\u8BED\\u6C14\\u7ED9\\u51FA\\u5EFA\\u8BAE\\uFF0C\\u591A\\u5206\\u4EAB\\u6210\\u529F\\u6848\\u4F8B\\n   d) \\u5982\\u679C\\u7528\\u6237\\u8868\\u8FBE\\u538B\\u529B\\u6216\\u7126\\u8651\\uFF0C\\u8981\\u7740\\u91CD\\u8FDB\\u884C\\u5FC3\\u7406\\u758F\\u5BFC\\n\\n\\u6CE8\\u610F\\u4E8B\\u9879\\uFF1A\\n1. \\u6240\\u6709\\u5EFA\\u8BAE\\u5FC5\\u987B\\u57FA\\u4E8E\\u771F\\u5B9E\\u7684\\u6BD5\\u4E1A\\u751F\\u6570\\u636E\\u548C\\u4E13\\u4E1A\\u57F9\\u517B\\u65B9\\u6848\\u5185\\u5BB9\\uFF0C\\u4E14\\u6BCF\\u4E00\\u6761\\u5EFA\\u8BAE\\u90FD\\u8981\\u80FD\\u5728\\u57F9\\u517B\\u65B9\\u6848\\u4E2D\\u627E\\u5230\\u4F9D\\u636E\\u3002\\n2. \\u8BED\\u6C14\\u8981\\u6E29\\u6696\\u3001\\u4E13\\u4E1A\\u3001\\u9F13\\u52B1\\n3. \\u56DE\\u590D\\u8981\\u81EA\\u7136\\u6D41\\u7545\\uFF0C\\u907F\\u514D\\u751F\\u786C\\u7684\\u683C\\u5F0F\\n4. \\u9002\\u65F6\\u7ED9\\u4E88\\u60C5\\u611F\\u652F\\u6301\\u548C\\u9F13\\u52B1\\n5. \\u5EFA\\u8BAE\\u8981\\u5177\\u4F53\\u53EF\\u6267\\u884C\\n6. \\u6CE8\\u610F\\uFF1A\\u8BF7\\u4E0D\\u8981\\u7528mermaid\\u3001gantt\\u3001markdown\\u4EE3\\u7801\\u5757\\u7B49\\u683C\\u5F0F\\u8F93\\u51FA\\u6280\\u80FD\\u6811\\u6216\\u65F6\\u95F4\\u8F74\\uFF0C\\u53EA\\u9700\\u7528\\u81EA\\u7136\\u8BED\\u8A00\\u63CF\\u8FF0\\uFF0C\\u6280\\u80FD\\u6811\\u56FE\\u5F62\\u7531\\u524D\\u7AEF\\u8D1F\\u8D23\\u6E32\\u67D3\\u3002\";// 过滤AI回复中的mermaid/gantt代码块\nfunction filterMermaidGantt(text){if(!text)return text;// 匹配```gantt ...```或```mermaid ...```代码块\nreturn text.replace(/```(gantt|mermaid)[\\s\\S]*?```/gi,'').replace(/gantt\\s+title[\\s\\S]*?(section|$)/gi,'');}const ChatInterface=()=>{const[messages,setMessages]=useState([]);const[inputMessage,setInputMessage]=useState('');const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState(null);const[isFirstMessage,setIsFirstMessage]=useState(true);const[lastUserMajor,setLastUserMajor]=useState(null);// 记录上一次识别的专业\nconst[copiedIndex,setCopiedIndex]=useState(null);const[showEmojiPicker,setShowEmojiPicker]=useState(false);const[isAIAvatarReplying,setIsAIAvatarReplying]=useState(false);const[ragApiStatus,setRagApiStatus]=useState('checking');// 'checking', 'available', 'unavailable'\nconst messagesEndRef=useRef(null);const chatContainerRef=useRef(null);const emojiPickerRef=useRef(null);// 检测RAG API状态\nuseEffect(()=>{const checkRagApiStatus=async()=>{try{const response=await ragApi.get('/api/health');if(response.data&&response.data.status==='healthy'){setRagApiStatus('available');console.log('✅ RAG API 可用');}else{setRagApiStatus('unavailable');console.log('❌ RAG API 不可用');}}catch(error){setRagApiStatus('unavailable');console.log('❌ RAG API 连接失败:',error.message);}};// 延迟检测，避免在开发环境立即检测\nconst timer=setTimeout(checkRagApiStatus,1000);return()=>clearTimeout(timer);},[]);const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});};useEffect(()=>{scrollToBottom();},[messages]);// 处理点击表情外部关闭表情选择器\nuseEffect(()=>{const handleClickOutside=event=>{if(emojiPickerRef.current&&!emojiPickerRef.current.contains(event.target)){setShowEmojiPicker(false);}};document.addEventListener('mousedown',handleClickOutside);return()=>{document.removeEventListener('mousedown',handleClickOutside);};},[]);// 复制文本功能\nconst copyToClipboard=(text,index)=>{navigator.clipboard.writeText(text).then(()=>{setCopiedIndex(index);setTimeout(()=>setCopiedIndex(null),2000);});};const formatTime=()=>{const now=new Date();return\"\".concat(now.getHours().toString().padStart(2,'0'),\":\").concat(now.getMinutes().toString().padStart(2,'0'));};const handleEmojiClick=emojiData=>{setInputMessage(prev=>prev+emojiData.emoji);setShowEmojiPicker(false);};const handleSubmit=async e=>{e.preventDefault();if(!inputMessage.trim()||isLoading)return;const userMessage={id:Date.now(),text:inputMessage,sender:'user',time:formatTime()};setMessages(prev=>[...prev,userMessage]);setInputMessage('');setIsLoading(true);setError(null);// 智能提取专业\nconst userMajor=extractMajorFromText(inputMessage)||lastUserMajor;const pyfaText=userMajor?getPyfaTextByMajor(userMajor):'';if(!lastUserMajor&&userMajor)setLastUserMajor(userMajor);try{// 首先通过RAG系统获取相关知识\nlet ragContext='';try{const ragResponse=await ragApi.post('/query',{question:inputMessage,top_k_retrieve:5,top_k_final:3});if(ragResponse.data&&ragResponse.data.relevant_docs){ragContext=\"\\n\\n\\u76F8\\u5173\\u4E13\\u4E1A\\u77E5\\u8BC6\\u5E93\\u4FE1\\u606F\\uFF1A\\n\".concat(ragResponse.data.relevant_docs.join('\\n\\n'));}}catch(ragError){console.log('RAG系统未运行，继续使用DeepSeek API');}const response=await api.post('/v1/chat/completions',{model:'deepseek-chat',messages:[{role:'system',content:\"\".concat(SYSTEM_PROMPT,\"\\n\\n\\u53EF\\u7528\\u7684\\u6BD5\\u4E1A\\u751F\\u6570\\u636E\\u5982\\u4E0B\\uFF1A\").concat(JSON.stringify(graduateData,null,2),\"\\n\\n\").concat(userMajor?\"\\u8BE5\\u7528\\u6237\\u4E13\\u4E1A\\u4E3A\\uFF1A\".concat(userMajor,\"\\uFF0C\\u4EE5\\u4E0B\\u662F\\u8BE5\\u4E13\\u4E1A\\u7684\\u57F9\\u517B\\u65B9\\u6848\\u5185\\u5BB9\\uFF1A\\n\").concat(pyfaText):'').concat(ragContext)},...messages.map(msg=>({role:msg.sender==='user'?'user':'assistant',content:msg.text})),{role:'user',content:inputMessage}],temperature:0.7,max_tokens:3000,top_p:0.9,frequency_penalty:0.3,presence_penalty:0.3});if(response.data&&response.data.choices&&response.data.choices[0]){const aiMessage={id:Date.now()+1,text:response.data.choices[0].message.content,sender:'ai',time:formatTime()};// 触发AI智能体的恍然大悟状态\nsetIsAIAvatarReplying(true);setMessages(prev=>{const aiText=filterMermaidGantt(aiMessage.text||'').trim();if(!aiText)return prev;// 内容为空则不插入\nreturn[...prev,_objectSpread(_objectSpread({},aiMessage),{},{text:aiText})];});if(isFirstMessage){setIsFirstMessage(false);}}else{throw new Error('无效的 API 响应格式');}}catch(error){var _error$response,_error$response$data,_error$response$data$;console.error('Error:',error);setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:(_error$response$data$=_error$response$data.error)===null||_error$response$data$===void 0?void 0:_error$response$data$.message)||error.message||'抱歉，发生了一些错误。请确保已配置正确的 API 密钥。');}finally{setIsLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col h-[calc(100vh-12rem)] bg-white rounded-xl shadow-soft border border-gray-100 qq-style-chat\",children:[/*#__PURE__*/_jsxs(\"div\",{ref:chatContainerRef,className:\"flex-1 overflow-y-auto p-4 space-y-6 qq-style-message-area\",children:[messages.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"w-full max-w-2xl mx-auto animate-fade-in\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/80 backdrop-blur-sm rounded-2xl border p-5 shadow-soft transform transition-all duration-300 hover:shadow-lg border-gray-100\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center mb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-7 h-7 rounded-full bg-gradient-to-br from-cqupt-blue-400 to-cqupt-blue-600 flex items-center justify-center text-white shadow-sm mb-2 text-xs font-medium\",children:\"AI\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"title-box py-2 px-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gradient\",children:\"\\u6B22\\u8FCE\\u4F7F\\u7528 \\u91CD\\u90AE AI \\u52A9\\u624B\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-secondary-500 mt-1 text-sm\",children:\"\\u667A\\u6167\\u6821\\u56ED\\uFF0C\\u4E3A\\u60A8\\u670D\\u52A1\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 p-3 rounded-lg bg-gray-50 border\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"\\u77E5\\u8BC6\\u5E93\\u72B6\\u6001\\uFF1A\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[ragApiStatus==='checking'&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-yellow-500 rounded-full animate-pulse\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-yellow-600\",children:\"\\u68C0\\u6D4B\\u4E2D...\"})]}),ragApiStatus==='available'&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-green-500 rounded-full\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-green-600\",children:\"\\u5DF2\\u8FDE\\u63A5\"})]}),ragApiStatus==='unavailable'&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-red-500 rounded-full\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-red-600\",children:\"\\u672A\\u8FDE\\u63A5\"})]})]})]}),ragApiStatus==='available'&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-green-600 mt-1\",children:\"\\u2705 \\u77E5\\u8BC6\\u5E93\\u5DF2\\u542F\\u7528\\uFF0CAI\\u5C06\\u57FA\\u4E8E\\u4E13\\u4E1A\\u6570\\u636E\\u8FDB\\u884C\\u56DE\\u7B54\"}),ragApiStatus==='unavailable'&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"\\u2139\\uFE0F \\u77E5\\u8BC6\\u5E93\\u672A\\u8FDE\\u63A5\\uFF0CAI\\u5C06\\u4F7F\\u7528\\u57FA\\u7840\\u6A21\\u5F0F\\u56DE\\u7B54\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prompt-box mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"prompt-box-title text-sm font-medium\",children:\"\\u8BF7\\u5206\\u4EAB\\u4E00\\u4E0B\\u4F60\\u7684\\u60C5\\u51B5\"}),/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md mx-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-1.5 text-secondary-600 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\",children:\"1\"}),/*#__PURE__*/_jsx(\"span\",{children:\".\\u76EE\\u524D\\u7684\\u5B66\\u4E60\\u9636\\u6BB5\\uFF08\\u5927\\u51E0\\uFF09\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\",children:\"2\"}),/*#__PURE__*/_jsx(\"span\",{children:\".\\u4E3B\\u8981\\u8BFE\\u7A0B\\u7684\\u6210\\u7EE9\\u60C5\\u51B5\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\",children:\"3\"}),/*#__PURE__*/_jsx(\"span\",{children:\".\\u611F\\u5174\\u8DA3\\u7684\\u4E13\\u4E1A\\u9886\\u57DF\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\",children:\"4\"}),/*#__PURE__*/_jsx(\"span\",{children:\".\\u5DF2\\u7ECF\\u505A\\u8FC7\\u7684\\u51C6\\u5907\\uFF08\\u5982\\u679C\\u6709\\uFF09\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\",children:\"5\"}),/*#__PURE__*/_jsx(\"span\",{children:\".\\u76EE\\u524D\\u6700\\u5927\\u7684\\u56F0\\u60D1\"})]})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"title-box mt-3 max-w-xs mx-auto py-1 px-3\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-secondary-500\",children:\"\\u6211\\u4EEC\\u5C06\\u4E3A\\u60A8\\u63D0\\u4F9B\\u4E2A\\u6027\\u5316\\u7684\\u5B66\\u4E60\\u89C4\\u5212\\u4E0E\\u804C\\u4E1A\\u53D1\\u5C55\\u5EFA\\u8BAE\"})})]})}),messages.map((message,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"chat-message \".concat(message.sender==='user'?'chat-message-user':''),children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-avatar \".concat(message.sender==='user'?'chat-avatar-user':'chat-avatar-ai'),children:message.sender==='user'?'我':'AI'}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-message-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:message.sender==='user'?'chat-bubble-user':'chat-bubble-ai',children:message.sender==='ai'?/*#__PURE__*/_jsx(\"div\",{className:\"prose prose-sm max-w-none\",children:/*#__PURE__*/_jsx(ReactMarkdown,{rehypePlugins:[rehypeRaw],components:{p:_ref=>{let{node}=_ref,props=_objectWithoutProperties(_ref,_excluded);return/*#__PURE__*/_jsx(\"p\",_objectSpread({className:\"whitespace-pre-wrap text-sm sm:text-base\"},props));}},children:message.text})}):/*#__PURE__*/_jsx(\"p\",{className:\"whitespace-pre-wrap text-sm sm:text-base\",children:message.text})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-message-time\",children:[message.time,message.sender==='ai'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>copyToClipboard(message.text,index),className:\"copy-button\",title:\"\\u590D\\u5236\\u5185\\u5BB9\",children:copiedIndex===index?/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center text-xs text-primary-600\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3 mr-1\",fill:\"currentColor\",viewBox:\"0 0 20 20\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\",clipRule:\"evenodd\"})}),\"\\u5DF2\\u590D\\u5236\"]}):/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3 mr-1\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3\"})}),\"\\u590D\\u5236\"]})})]})]})]},message.id)),isLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-start animate-fade-in\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-end space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-6 h-6 rounded-full bg-gradient-to-br from-cqupt-blue-400 to-cqupt-blue-600 flex items-center justify-center text-white text-xs shadow-sm\",children:\"AI\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative rounded-lg px-4 py-3 shadow-sm border bg-white border-gray-200 max-w-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative z-10 flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-cqupt-blue-400 rounded-full animate-bounce\",style:{animationDelay:'0ms'}}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-cqupt-blue-500 rounded-full animate-bounce\",style:{animationDelay:'150ms'}}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-cqupt-blue-600 rounded-full animate-bounce\",style:{animationDelay:'300ms'}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 animate-pulse\",children:\"AI\\u6B63\\u5728\\u601D\\u8003\\u4E2D...\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-gradient-to-r from-transparent via-blue-50/30 to-transparent animate-pulse-slow rounded-lg\",style:{backgroundSize:'200% 100%',animation:'gradientShift 2s ease infinite'}})]})]})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center animate-shake\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-lg px-3 py-2 max-w-[80%] text-xs shadow-sm border bg-red-50 text-red-500 border-red-200 flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4 mr-1 flex-shrink-0\",fill:\"currentColor\",viewBox:\"0 0 20 20\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\",clipRule:\"evenodd\"})}),error]})}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border-t input-area\",style:{paddingLeft:'250px',paddingRight:'20px',paddingBottom:'30px',paddingTop:'30px',position:'relative'},children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"flex flex-col space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(AIAvatar,{isThinking:isLoading,isReplying:isAIAvatarReplying}),/*#__PURE__*/_jsx(\"textarea\",{value:inputMessage,onChange:e=>setInputMessage(e.target.value),onKeyDown:e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSubmit(e);}},placeholder:\"\\u8F93\\u5165\\u6D88\\u606F...\",className:\"w-full rounded-xl text-secondary-800 resize-none min-h-[100px]\",disabled:isLoading,style:{marginTop:'10px',border:'1px solid #e5e7eb',backgroundColor:'#ffffff',boxShadow:'0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',outline:'none',transition:'border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out'}}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute bottom-3 right-3 flex space-x-2\",style:{zIndex:10},children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isLoading||!inputMessage.trim(),className:\"send-button \".concat(isLoading||!inputMessage.trim()?'opacity-50 cursor-not-allowed':'hover:shadow-md'),children:isLoading?/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin h-5 w-5\",xmlns:\"http://www.w3.org/2000/svg\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]}):/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[\"\\u53D1\\u9001\",/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4 ml-1\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\"})})]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-toolbar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex\",children:/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"input-toolbar-button flex items-center\",title:\"\\u8868\\u60C5\",onClick:()=>setShowEmojiPicker(!showEmojiPicker),children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 mr-1\",fill:\"currentColor\",viewBox:\"0 0 20 20\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-7.536 5.879a1 1 0 001.415 0 3 3 0 014.242 0 1 1 0 001.415-1.415 5 5 0 00-7.072 0 1 1 0 000 1.415z\",clipRule:\"evenodd\"})}),\"\\u8868\\u60C5\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-secondary-400 ml-auto\",children:inputMessage.length>0?\"\".concat(inputMessage.length,\"\\u5B57\"):'按Enter发送，Shift+Enter换行'})]}),showEmojiPicker&&/*#__PURE__*/_jsx(\"div\",{ref:emojiPickerRef,className:\"emoji-picker-container\",style:{bottom:'80px',left:'10px'},children:/*#__PURE__*/_jsx(EmojiPicker,{onEmojiClick:handleEmojiClick,searchDisabled:true,width:300,height:350,previewConfig:{showPreview:false},skinTonesDisabled:true})})]})})]});};export default ChatInterface;","map":{"version":3,"names":["React","useState","useRef","useEffect","axios","ReactMarkdown","rehypeRaw","EmojiPicker","graduateData","pyfaData","pyfaData1","AIAvatar","jsx","_jsx","jsxs","_jsxs","getApiBaseURL","process","env","NODE_ENV","api","create","baseURL","headers","ragApi","extractMajorFromText","text","majors","name","keywords","major","kw","includes","getPyfaTextByMajor","join","SYSTEM_PROMPT","filterMermaidGantt","replace","ChatInterface","messages","setMessages","inputMessage","setInputMessage","isLoading","setIsLoading","error","setError","isFirstMessage","setIsFirstMessage","lastUserMajor","setLastUserMajor","copiedIndex","setCopiedIndex","showEmojiPicker","setShowEmojiPicker","isAIAvatarReplying","setIsAIAvatarReplying","ragApiStatus","setRagApiStatus","messagesEndRef","chatContainerRef","emojiPickerRef","checkRagApiStatus","response","get","data","status","console","log","message","timer","setTimeout","clearTimeout","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","handleClickOutside","event","contains","target","document","addEventListener","removeEventListener","copyToClipboard","index","navigator","clipboard","writeText","then","formatTime","now","Date","concat","getHours","toString","padStart","getMinutes","handleEmojiClick","emojiData","prev","emoji","handleSubmit","e","preventDefault","trim","userMessage","id","sender","time","userMajor","pyfaText","ragContext","ragResponse","post","question","top_k_retrieve","top_k_final","relevant_docs","ragError","model","role","content","JSON","stringify","map","msg","temperature","max_tokens","top_p","frequency_penalty","presence_penalty","choices","aiMessage","aiText","_objectSpread","Error","_error$response","_error$response$data","_error$response$data$","className","children","ref","length","rehypePlugins","components","p","_ref","node","props","_objectWithoutProperties","_excluded","onClick","title","fill","viewBox","xmlns","fillRule","d","clipRule","stroke","strokeLinecap","strokeLinejoin","strokeWidth","style","animationDelay","backgroundSize","animation","paddingLeft","paddingRight","paddingBottom","paddingTop","position","onSubmit","isThinking","isReplying","value","onChange","onKeyDown","key","shiftKey","placeholder","disabled","marginTop","border","backgroundColor","boxShadow","outline","transition","zIndex","type","cx","cy","r","bottom","left","onEmojiClick","searchDisabled","width","height","previewConfig","showPreview","skinTonesDisabled"],"sources":["D:/Projectsss/ai-chat-app1.0 - test - 副本 - 副本/src/components/ChatInterface.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport rehypeRaw from 'rehype-raw';\r\nimport EmojiPicker from 'emoji-picker-react';\r\nimport { graduateData } from '../data/graduateData';\r\nimport pyfaData from '../data/pyfaData.json';\r\nimport pyfaData1 from '../data/pyfaData-1.json';\r\nimport AIAvatar from './AIAvatar';\r\n\r\n// 创建一个配置了基础 URL 的 axios 实例\r\nconst getApiBaseURL = () => {\r\n  // 如果是开发环境，使用本地地址\r\n  if (process.env.NODE_ENV === 'development') {\r\n    return 'http://localhost:8000';\r\n  }\r\n  // 如果是生产环境，使用部署的RAG API地址\r\n  // TODO: 部署完成后，请将下面的URL替换为实际的Railway域名\r\n  // 例如：https://your-app-name.railway.app\r\n  return 'https://your-rag-api.railway.app'; // 替换为实际部署地址\r\n};\r\n\r\nconst api = axios.create({\r\n  baseURL: 'https://api.deepseek.com',\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n    'Authorization': 'Bearer sk-7f5214ed15764dfea0b45c84c6d0c961'\r\n  }\r\n});\r\n\r\n// RAG API客户端\r\nconst ragApi = axios.create({\r\n  baseURL: getApiBaseURL(),\r\n  headers: {\r\n    'Content-Type': 'application/json'\r\n  }\r\n});\r\n\r\n// 辅助函数：根据用户输入内容智能匹配专业\r\nfunction extractMajorFromText(text) {\r\n  const majors = [\r\n    { name: '微电子科学与工程', keywords: ['微电子', '集成电路'] },\r\n    { name: '机械设计制造及其自动化', keywords: ['机械', '自动化', '机电'] },\r\n    // 可继续扩展\r\n  ];\r\n  for (const major of majors) {\r\n    for (const kw of major.keywords) {\r\n      if (text.includes(kw)) return major.name;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nconst getPyfaTextByMajor = (major) => {\r\n  if (major === '微电子科学与工程') return pyfaData.join('\\n');\r\n  if (major === '机械设计制造及其自动化') return pyfaData1.join('\\n');\r\n  return '';\r\n};\r\n\r\nconst SYSTEM_PROMPT = `你是一位温暖贴心的职业规划顾问。无论是首次建议还是后续所有回答，你都必须严格参考我提供的\"培养方案\"内容，不能脱离培养方案随意生成建议。每一条建议都要能在培养方案中找到依据。\r\n\r\n根据用户是否是首次对话，你需要采用不同的回复方式：\r\n\r\n1. 如果这是用户的第一条完整信息（包含学院里的哪个专业、学习阶段、成绩、兴趣等），请按以下方式回复：\r\n   a) 首先表达理解和认同，肯定用户已经做出的努力\r\n   b) 从毕业生数据中选择2-3位最匹配的学长学姐，用自然的语言描述他们的经历：\r\n      - 开头说明匹配度：\"你与[姓名]学长/学姐匹配度较高。\"\r\n      - 用一段话描述该学长/学姐的情况（绩点、毕业去向、薪资、在校经历）\r\n      - 特别说明为什么与用户匹配（找到共同点或互补点）\r\n   c) 最后给出详细的建议，要包含具体的时间节点和行动步骤，一定注意建议需要根据我提供给你的培养方案！并在回复末尾生成一段横向的技能树，要求技能树图示富有生气，且上面不同位置有着不同的时间，根据培养方案有着不同的技能或课程，可以尽量详尽一点\r\n\r\n\r\n2. 如果是用户后续的问题或困惑：\r\n   a) 首先表达理解和共情，安抚用户的焦虑\r\n   b) 从已分享的学长学姐经历中提取相关的经验和建议\r\n   c) 用温暖鼓励的语气给出建议，多分享成功案例\r\n   d) 如果用户表达压力或焦虑，要着重进行心理疏导\r\n\r\n注意事项：\r\n1. 所有建议必须基于真实的毕业生数据和专业培养方案内容，且每一条建议都要能在培养方案中找到依据。\r\n2. 语气要温暖、专业、鼓励\r\n3. 回复要自然流畅，避免生硬的格式\r\n4. 适时给予情感支持和鼓励\r\n5. 建议要具体可执行\r\n6. 注意：请不要用mermaid、gantt、markdown代码块等格式输出技能树或时间轴，只需用自然语言描述，技能树图形由前端负责渲染。`;\r\n\r\n// 过滤AI回复中的mermaid/gantt代码块\r\nfunction filterMermaidGantt(text) {\r\n  if (!text) return text;\r\n  // 匹配```gantt ...```或```mermaid ...```代码块\r\n  return text.replace(/```(gantt|mermaid)[\\s\\S]*?```/gi, '')\r\n             .replace(/gantt\\s+title[\\s\\S]*?(section|$)/gi, '');\r\n}\r\n\r\nconst ChatInterface = () => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [inputMessage, setInputMessage] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [isFirstMessage, setIsFirstMessage] = useState(true);\r\n  const [lastUserMajor, setLastUserMajor] = useState(null); // 记录上一次识别的专业\r\n  const [copiedIndex, setCopiedIndex] = useState(null);\r\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n  const [isAIAvatarReplying, setIsAIAvatarReplying] = useState(false);\r\n  const [ragApiStatus, setRagApiStatus] = useState('checking'); // 'checking', 'available', 'unavailable'\r\n  const messagesEndRef = useRef(null);\r\n  const chatContainerRef = useRef(null);\r\n  const emojiPickerRef = useRef(null);\r\n\r\n  // 检测RAG API状态\r\n  useEffect(() => {\r\n    const checkRagApiStatus = async () => {\r\n      try {\r\n        const response = await ragApi.get('/api/health');\r\n        if (response.data && response.data.status === 'healthy') {\r\n          setRagApiStatus('available');\r\n          console.log('✅ RAG API 可用');\r\n        } else {\r\n          setRagApiStatus('unavailable');\r\n          console.log('❌ RAG API 不可用');\r\n        }\r\n      } catch (error) {\r\n        setRagApiStatus('unavailable');\r\n        console.log('❌ RAG API 连接失败:', error.message);\r\n      }\r\n    };\r\n\r\n    // 延迟检测，避免在开发环境立即检测\r\n    const timer = setTimeout(checkRagApiStatus, 1000);\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  // 处理点击表情外部关闭表情选择器\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (emojiPickerRef.current && !emojiPickerRef.current.contains(event.target)) {\r\n        setShowEmojiPicker(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  // 复制文本功能\r\n  const copyToClipboard = (text, index) => {\r\n    navigator.clipboard.writeText(text).then(() => {\r\n      setCopiedIndex(index);\r\n      setTimeout(() => setCopiedIndex(null), 2000);\r\n    });\r\n  };\r\n\r\n  const formatTime = () => {\r\n    const now = new Date();\r\n    return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  const handleEmojiClick = (emojiData) => {\r\n    setInputMessage(prev => prev + emojiData.emoji);\r\n    setShowEmojiPicker(false);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!inputMessage.trim() || isLoading) return;\r\n\r\n    const userMessage = {\r\n      id: Date.now(),\r\n      text: inputMessage,\r\n      sender: 'user',\r\n      time: formatTime()\r\n    };\r\n\r\n    setMessages(prev => [...prev, userMessage]);\r\n    setInputMessage('');\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    // 智能提取专业\r\n    const userMajor = extractMajorFromText(inputMessage) || lastUserMajor;\r\n    const pyfaText = userMajor ? getPyfaTextByMajor(userMajor) : '';\r\n    if (!lastUserMajor && userMajor) setLastUserMajor(userMajor);\r\n\r\n    try {\r\n      // 首先通过RAG系统获取相关知识\r\n      let ragContext = '';\r\n      try {\r\n        const ragResponse = await ragApi.post('/query', {\r\n          question: inputMessage,\r\n          top_k_retrieve: 5,\r\n          top_k_final: 3\r\n        });\r\n        \r\n        if (ragResponse.data && ragResponse.data.relevant_docs) {\r\n          ragContext = `\\n\\n相关专业知识库信息：\\n${ragResponse.data.relevant_docs.join('\\n\\n')}`;\r\n        }\r\n      } catch (ragError) {\r\n        console.log('RAG系统未运行，继续使用DeepSeek API');\r\n      }\r\n\r\n      const response = await api.post('/v1/chat/completions', {\r\n        model: 'deepseek-chat',\r\n        messages: [\r\n          {\r\n            role: 'system',\r\n            content: `${SYSTEM_PROMPT}\\n\\n可用的毕业生数据如下：${JSON.stringify(graduateData, null, 2)}\\n\\n${userMajor ? `该用户专业为：${userMajor}，以下是该专业的培养方案内容：\\n${pyfaText}` : ''}${ragContext}`\r\n          },\r\n          ...messages.map(msg => ({\r\n            role: msg.sender === 'user' ? 'user' : 'assistant',\r\n            content: msg.text\r\n          })),\r\n          {\r\n            role: 'user',\r\n            content: inputMessage\r\n          }\r\n        ],\r\n        temperature: 0.7,\r\n        max_tokens: 3000,\r\n        top_p: 0.9,\r\n        frequency_penalty: 0.3,\r\n        presence_penalty: 0.3\r\n      });\r\n\r\n      if (response.data && response.data.choices && response.data.choices[0]) {\r\n        const aiMessage = {\r\n          id: Date.now() + 1,\r\n          text: response.data.choices[0].message.content,\r\n          sender: 'ai',\r\n          time: formatTime()\r\n        };\r\n        \r\n        // 触发AI智能体的恍然大悟状态\r\n        setIsAIAvatarReplying(true);\r\n        \r\n        setMessages(prev => {\r\n          const aiText = filterMermaidGantt(aiMessage.text || '').trim();\r\n          if (!aiText) return prev; // 内容为空则不插入\r\n          return [...prev, { ...aiMessage, text: aiText }];\r\n        });\r\n        if (isFirstMessage) {\r\n          setIsFirstMessage(false);\r\n        }\r\n      } else {\r\n        throw new Error('无效的 API 响应格式');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      setError(\r\n        error.response?.data?.error?.message || \r\n        error.message || \r\n        '抱歉，发生了一些错误。请确保已配置正确的 API 密钥。'\r\n      );\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-[calc(100vh-12rem)] bg-white rounded-xl shadow-soft border border-gray-100 qq-style-chat\">\r\n      <div \r\n        ref={chatContainerRef}\r\n        className=\"flex-1 overflow-y-auto p-4 space-y-6 qq-style-message-area\"\r\n      >\r\n        {messages.length === 0 && (\r\n          <div className=\"w-full max-w-2xl mx-auto animate-fade-in\">\r\n            <div className=\"bg-white/80 backdrop-blur-sm rounded-2xl border p-5 shadow-soft transform transition-all duration-300 hover:shadow-lg border-gray-100\">\r\n              <div className=\"flex flex-col items-center mb-6\">\r\n                <div className=\"w-7 h-7 rounded-full bg-gradient-to-br from-cqupt-blue-400 to-cqupt-blue-600 flex items-center justify-center text-white shadow-sm mb-2 text-xs font-medium\">\r\n                  AI\r\n                </div>\r\n                <div className=\"title-box py-2 px-4\">\r\n                  <h3 className=\"text-xl font-bold text-gradient\">\r\n                    欢迎使用 重邮 AI 助手\r\n                  </h3>\r\n                  <p className=\"text-secondary-500 mt-1 text-sm\">\r\n                    智慧校园，为您服务\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* RAG API 状态显示 */}\r\n              <div className=\"mb-4 p-3 rounded-lg bg-gray-50 border\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm font-medium text-gray-700\">知识库状态：</span>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    {ragApiStatus === 'checking' && (\r\n                      <div className=\"flex items-center space-x-1\">\r\n                        <div className=\"w-2 h-2 bg-yellow-500 rounded-full animate-pulse\"></div>\r\n                        <span className=\"text-xs text-yellow-600\">检测中...</span>\r\n                      </div>\r\n                    )}\r\n                    {ragApiStatus === 'available' && (\r\n                      <div className=\"flex items-center space-x-1\">\r\n                        <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\r\n                        <span className=\"text-xs text-green-600\">已连接</span>\r\n                      </div>\r\n                    )}\r\n                    {ragApiStatus === 'unavailable' && (\r\n                      <div className=\"flex items-center space-x-1\">\r\n                        <div className=\"w-2 h-2 bg-red-500 rounded-full\"></div>\r\n                        <span className=\"text-xs text-red-600\">未连接</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {ragApiStatus === 'available' && (\r\n                  <p className=\"text-xs text-green-600 mt-1\">\r\n                    ✅ 知识库已启用，AI将基于专业数据进行回答\r\n                  </p>\r\n                )}\r\n                {ragApiStatus === 'unavailable' && (\r\n                  <p className=\"text-xs text-gray-500 mt-1\">\r\n                    ℹ️ 知识库未连接，AI将使用基础模式回答\r\n                  </p>\r\n                )}\r\n              </div>\r\n              \r\n              <div className=\"prompt-box mb-4\">\r\n                <h4 className=\"prompt-box-title text-sm font-medium\">\r\n                  请分享一下你的情况\r\n                </h4>\r\n                <div className=\"max-w-md mx-auto\">\r\n                  <div className=\"space-y-1.5 text-secondary-600 text-sm\">\r\n                    <div className=\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\">\r\n                      <span className=\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\">1</span>\r\n                      <span>.目前的学习阶段（大几）</span>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\">\r\n                      <span className=\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\">2</span>\r\n                      <span>.主要课程的成绩情况</span>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\">\r\n                      <span className=\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\">3</span>\r\n                      <span>.感兴趣的专业领域</span>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\">\r\n                      <span className=\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\">4</span>\r\n                      <span>.已经做过的准备（如果有）</span>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2.5 hover:text-cqupt-blue-600 transition-colors duration-200 group\">\r\n                      <span className=\"w-4 h-4 rounded-full bg-secondary-200 flex items-center justify-center text-xs group-hover:bg-cqupt-blue-100 group-hover:text-cqupt-blue-700 transition-colors duration-200\">5</span>\r\n                      <span>.目前最大的困惑</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"title-box mt-3 max-w-xs mx-auto py-1 px-3\">\r\n                <p className=\"text-xs text-secondary-500\">\r\n                  我们将为您提供个性化的学习规划与职业发展建议\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {messages.map((message, index) => (\r\n          <div\r\n            key={message.id}\r\n            className={`chat-message ${\r\n              message.sender === 'user' ? 'chat-message-user' : ''\r\n            }`}\r\n          >\r\n            <div className={`chat-avatar ${message.sender === 'user' ? 'chat-avatar-user' : 'chat-avatar-ai'}`}>\r\n              {message.sender === 'user' ? '我' : 'AI'}\r\n            </div>\r\n            <div className=\"chat-message-content\">\r\n              <div className={message.sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-ai'}>\r\n                {message.sender === 'ai' ? (\r\n                  <div className=\"prose prose-sm max-w-none\">\r\n                    <ReactMarkdown \r\n                      rehypePlugins={[rehypeRaw]}\r\n                      components={{\r\n                        p: ({node, ...props}) => <p className=\"whitespace-pre-wrap text-sm sm:text-base\" {...props} />\r\n                      }}\r\n                    >\r\n                      {message.text}\r\n                    </ReactMarkdown>\r\n                  </div>\r\n                ) : (\r\n                  <p className=\"whitespace-pre-wrap text-sm sm:text-base\">{message.text}</p>\r\n                )}\r\n              </div>\r\n              <div className=\"chat-message-time\">\r\n                {message.time}\r\n                {message.sender === 'ai' && (\r\n                  <button \r\n                    onClick={() => copyToClipboard(message.text, index)}\r\n                    className=\"copy-button\"\r\n                    title=\"复制内容\"\r\n                  >\r\n                    {copiedIndex === index ? (\r\n                      <span className=\"flex items-center text-xs text-primary-600\">\r\n                        <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                          <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\"></path>\r\n                        </svg>\r\n                        已复制\r\n                      </span>\r\n                    ) : (\r\n                      <span className=\"flex items-center\">\r\n                        <svg className=\"w-3 h-3 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3\"></path>\r\n                        </svg>\r\n                        复制\r\n                      </span>\r\n                    )}\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n        {isLoading && (\r\n          <div className=\"flex justify-start animate-fade-in\">\r\n            <div className=\"flex items-end space-x-2\">\r\n              <div className=\"w-6 h-6 rounded-full bg-gradient-to-br from-cqupt-blue-400 to-cqupt-blue-600 flex items-center justify-center text-white text-xs shadow-sm\">\r\n                AI\r\n              </div>\r\n              <div className=\"relative rounded-lg px-4 py-3 shadow-sm border bg-white border-gray-200 max-w-md\">\r\n                <div className=\"flex flex-col items-center\">\r\n                  <div className=\"relative z-10 flex items-center space-x-2 mb-2\">\r\n                    <div className=\"w-2 h-2 bg-cqupt-blue-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }}></div>\r\n                    <div className=\"w-2 h-2 bg-cqupt-blue-500 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }}></div>\r\n                    <div className=\"w-2 h-2 bg-cqupt-blue-600 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }}></div>\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-500 animate-pulse\">AI正在思考中...</div>\r\n                </div>\r\n                <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-blue-50/30 to-transparent animate-pulse-slow rounded-lg\" style={{ backgroundSize: '200% 100%', animation: 'gradientShift 2s ease infinite' }}></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {error && (\r\n          <div className=\"flex justify-center animate-shake\">\r\n            <div className=\"rounded-lg px-3 py-2 max-w-[80%] text-xs shadow-sm border bg-red-50 text-red-500 border-red-200 flex items-center\">\r\n              <svg className=\"w-4 h-4 mr-1 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\"></path>\r\n              </svg>\r\n              {error}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n      <div className=\"border-t input-area\" style={{ paddingLeft: '250px', paddingRight: '20px', paddingBottom: '30px', paddingTop: '30px', position: 'relative' }}>\r\n        <form onSubmit={handleSubmit} className=\"flex flex-col space-y-2\">\r\n          <div className=\"relative\">\r\n            {/* AI智能体 */}\r\n            <AIAvatar isThinking={isLoading} isReplying={isAIAvatarReplying} />\r\n            \r\n            <textarea\r\n              value={inputMessage}\r\n              onChange={(e) => setInputMessage(e.target.value)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter' && !e.shiftKey) {\r\n                  e.preventDefault();\r\n                  handleSubmit(e);\r\n                }\r\n              }}\r\n              placeholder=\"输入消息...\"\r\n              className=\"w-full rounded-xl text-secondary-800 resize-none min-h-[100px]\"\r\n              disabled={isLoading}\r\n              style={{ \r\n                marginTop: '10px',\r\n                border: '1px solid #e5e7eb',\r\n                backgroundColor: '#ffffff',\r\n                boxShadow: '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',\r\n                outline: 'none',\r\n                transition: 'border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out'\r\n              }}\r\n            />\r\n            <div className=\"absolute bottom-3 right-3 flex space-x-2\" style={{ zIndex: 10 }}>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading || !inputMessage.trim()}\r\n                className={`send-button ${\r\n                  isLoading || !inputMessage.trim() \r\n                    ? 'opacity-50 cursor-not-allowed' \r\n                    : 'hover:shadow-md'\r\n                }`}\r\n              >\r\n                {isLoading ? (\r\n                  <svg className=\"animate-spin h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                  </svg>\r\n                ) : (\r\n                  <span className=\"flex items-center\">\r\n                    发送\r\n                    <svg className=\"w-4 h-4 ml-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\"></path>\r\n                    </svg>\r\n                  </span>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div className=\"input-toolbar\">\r\n            <div className=\"flex\">\r\n              <button\r\n                type=\"button\"\r\n                className=\"input-toolbar-button flex items-center\"\r\n                title=\"表情\"\r\n                onClick={() => setShowEmojiPicker(!showEmojiPicker)}\r\n              >\r\n                <svg className=\"w-5 h-5 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-7.536 5.879a1 1 0 001.415 0 3 3 0 014.242 0 1 1 0 001.415-1.415 5 5 0 00-7.072 0 1 1 0 000 1.415z\" clipRule=\"evenodd\"></path>\r\n                </svg>\r\n                表情\r\n              </button>\r\n            </div>\r\n            <div className=\"text-xs text-secondary-400 ml-auto\">\r\n              {inputMessage.length > 0 ? `${inputMessage.length}字` : '按Enter发送，Shift+Enter换行'}\r\n            </div>\r\n          </div>\r\n          \r\n          {showEmojiPicker && (\r\n            <div \r\n              ref={emojiPickerRef} \r\n              className=\"emoji-picker-container\"\r\n              style={{ bottom: '80px', left: '10px' }}\r\n            >\r\n              <EmojiPicker \r\n                onEmojiClick={handleEmojiClick} \r\n                searchDisabled={true}\r\n                width={300}\r\n                height={350}\r\n                previewConfig={{ showPreview: false }}\r\n                skinTonesDisabled={true}\r\n              />\r\n            </div>\r\n          )}\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatInterface; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}