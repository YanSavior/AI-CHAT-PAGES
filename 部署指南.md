# RAG API 部署指南

## 🚀 快速部署

### 方案1：Railway（推荐）

#### 步骤1：准备代码
```bash
# 确保所有文件都已提交到GitHub
git add .
git commit -m "Add RAG API deployment files"
git push origin main
```

#### 步骤2：部署到Railway
1. 访问 [Railway.app](https://railway.app)
2. 使用GitHub账号登录
3. 点击 "New Project"
4. 选择 "Deploy from GitHub repo"
5. 选择您的GitHub仓库
6. 等待部署完成（约5-10分钟）
7. 复制生成的域名（如：`https://your-app-name.railway.app`）

#### 步骤3：更新前端配置
在 `src/components/ChatInterface.js` 和 `src/components/FreshmanChatInterface.js` 中：
```javascript
// 将这一行：
return 'https://your-rag-api.railway.app';

// 替换为实际的Railway域名：
return 'https://your-app-name.railway.app';
```

### 方案2：Render

#### 步骤1：准备代码
同上

#### 步骤2：部署到Render
1. 访问 [Render.com](https://render.com)
2. 使用GitHub账号登录
3. 点击 "New +" 选择 "Web Service"
4. 连接您的GitHub仓库
5. 设置配置：
   - **Name**: `rag-api`
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `uvicorn api_server:app --host 0.0.0.0 --port $PORT`
6. 点击 "Create Web Service"
7. 等待部署完成
8. 复制生成的域名

## 🔧 本地测试

### 启动RAG API服务器
```bash
# 安装依赖
pip install -r requirements.txt

# 启动API服务器
python api_server.py
```

### 测试API
```bash
# 健康检查
curl http://localhost:8000/api/health

# 测试查询
curl -X POST http://localhost:8000/api/query \
  -H "Content-Type: application/json" \
  -d '{"question": "计算机专业需要修多少学分？"}'
```

## 📊 监控和日志

### Railway监控
- 访问Railway仪表板查看部署状态
- 查看日志：`railway logs`
- 监控资源使用情况

### Render监控
- 访问Render仪表板查看服务状态
- 查看实时日志
- 监控性能指标

## 🔄 自动部署

### GitHub Actions（可选）
创建 `.github/workflows/deploy.yml`：
```yaml
name: Deploy RAG API

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Deploy to Railway
      uses: railway/deploy@v1
      with:
        railway_token: ${{ secrets.RAILWAY_TOKEN }}
```

## 🛠️ 故障排除

### 常见问题

1. **部署失败**
   - 检查 `requirements.txt` 是否包含所有依赖
   - 确保 `api_server.py` 存在且语法正确
   - 查看部署日志

2. **API无法访问**
   - 检查防火墙设置
   - 确认端口配置正确
   - 验证域名是否正确

3. **模型下载失败**
   - 检查网络连接
   - 增加部署超时时间
   - 使用镜像源

### 调试命令
```bash
# 检查API状态
curl -X GET https://your-api-domain.com/api/health

# 测试查询
curl -X POST https://your-api-domain.com/api/query \
  -H "Content-Type: application/json" \
  -d '{"question": "测试问题"}'
```

## 💡 优化建议

1. **性能优化**
   - 使用GPU加速（如果可用）
   - 优化向量数据库查询
   - 实现缓存机制

2. **成本优化**
   - 选择合适的部署平台
   - 监控资源使用
   - 设置自动休眠

3. **安全优化**
   - 添加API密钥认证
   - 限制请求频率
   - 启用HTTPS

## 📞 支持

如果遇到问题，请：
1. 查看部署日志
2. 检查配置文件
3. 联系平台支持
4. 提交Issue到GitHub仓库 