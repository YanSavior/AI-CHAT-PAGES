# 混合RAG系统实现说明

## 概述

为了解决内网穿透不稳定的问题，我们实现了一个混合RAG（检索增强生成）系统，该系统直接在前端实现RAG功能，同时支持本地检索和DeepSeek API调用，无需依赖内网穿透。

## 实现原理

混合RAG系统主要包含以下几个核心组件：

1. **本地RAG检索引擎**：基于关键词匹配的简化版RAG系统，直接在浏览器中运行
2. **DeepSeek API集成**：将检索到的相关文档注入到DeepSeek API的系统提示中
3. **自动降级机制**：当远程API或DeepSeek API不可用时，自动降级到本地处理
4. **无缝切换**：在远程RAG API和本地RAG系统之间自动切换，保证系统可用性

## 技术实现

### 1. 混合RAG系统核心类

`src/utils/hybridRAGSystem.js` 实现了混合RAG系统的核心逻辑：

- 初始化本地知识库
- 使用简单的关键词匹配算法进行相关文档检索
- 调用DeepSeek API生成回答
- 提供本地回退方案，当API调用失败时使用

### 2. 集成到现有聊天界面

`src/components/ChatInterface.js` 中集成了混合RAG系统：

- 自动检测远程RAG API的可用性
- 如果远程API不可用，自动初始化并使用混合RAG系统
- 保持原有的UI界面和用户体验不变

### 3. 配置系统

`src/config/ragConfig.js` 中添加了混合RAG模式的配置：

- 控制是否启用混合RAG模式
- 设置默认检索文档数量
- 配置是否使用本地回退方案
- 管理API密钥

## 优势

1. **无需内网穿透**：直接在前端实现RAG功能，避免了内网穿透的不稳定性
2. **高可用性**：多级降级机制确保系统在各种情况下都能正常工作
3. **无缝体验**：用户无需关心后端实现，体验保持一致
4. **易于部署**：减少了部署复杂度，只需启动前端应用
5. **兼容现有系统**：保留了原有的远程API调用方式，实现了向后兼容

## 工作流程

1. 用户发送问题
2. 系统首先尝试使用远程RAG API检索相关文档
3. 如果远程API不可用，切换到本地RAG系统检索
4. 将检索到的相关文档与用户问题一起发送给DeepSeek API
5. 如果DeepSeek API调用失败，使用本地回退方案生成回答
6. 将回答展示给用户

## 未来改进

1. **提升本地检索质量**：可以引入更先进的文本匹配算法
2. **本地知识库管理**：添加知识库更新和管理功能
3. **离线支持**：实现完全离线的RAG功能
4. **个性化知识库**：根据用户偏好自定义知识库内容
5. **混合模式优化**：进一步优化本地和远程API的协同工作方式

## 结论

混合RAG系统成功解决了内网穿透不稳定的问题，提供了一种更可靠、更易于部署的RAG解决方案。通过在前端直接实现RAG功能，我们实现了系统的高可用性，同时保持了良好的用户体验。 